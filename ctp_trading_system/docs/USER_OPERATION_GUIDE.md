# CTP程序化交易系统 - 用户操作指南

> **适用对象**：完全没有经验的新手用户
> **系统版本**：v1.0.0
> **符合标准**：T/ZQX 0004-2025《期货程序化交易系统功能测试指引》

---

## 目录

1. [系统简介](#一系统简介)
2. [准备工作](#二准备工作)
3. [连接登录](#三连接登录)
4. [交易操作](#四交易操作)
5. [监测面板](#五监测面板)
6. [阈值设置](#六阈值设置)
7. [错误防范测试](#七错误防范测试)
8. [应急处置](#八应急处置)
9. [日志查看](#九日志查看)
10. [常见问题解答](#十常见问题解答)

---

## 一、系统简介

### 1.1 这是什么系统？

这是一个**期货程序化交易系统**，可以帮助您：
- 连接期货交易服务器
- 进行期货合约的买卖操作
- 监控交易活动和风险
- 在紧急情况下快速处置

### 1.2 系统界面概览

打开系统后，您会看到以下区域：

```
┌─────────────────────────────────────────────────────────────────┐
│  CTP程序化交易系统                              [连接状态指示灯] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────┐  ┌─────────────────────┐  │
│  │                                 │  │     实时状态        │  │
│  │      主功能区                   │  │  ---------------    │  │
│  │  (7个功能标签页)                │  │  报单数: 0          │  │
│  │                                 │  │  撤单数: 0          │  │
│  │  [连接登录] [交易操作] [监测]   │  │  交易状态: 允许交易  │  │
│  │  [阈值设置] [错误防范] [应急]   │  │                     │  │
│  │  [日志查看]                     │  ├─────────────────────┤  │
│  │                                 │  │     实时日志        │  │
│  │                                 │  │  ---------------    │  │
│  │                                 │  │  12:30:45 INFO ...  │  │
│  │                                 │  │  12:30:40 INFO ...  │  │
│  └─────────────────────────────────┘  └─────────────────────┘  │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  报单: 0 | 撤单: 0    阈值状态: 正常    交易状态: 允许交易      │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 七个功能标签页

| 标签页 | 图标 | 功能说明 |
|--------|------|----------|
| 连接登录 | 🔌 | 连接服务器、认证、登录 |
| 交易操作 | 💱 | 开仓、平仓、撤单 |
| 监测面板 | 🖥️ | 查看连接状态、交易统计 |
| 阈值设置 | ⚙️ | 设置交易上限和预警 |
| 错误防范测试 | 🛡️ | 测试系统的错误检查功能 |
| 应急处置 | ⚠️ | 暂停交易、批量撤单 |
| 日志查看 | 📋 | 查看系统运行日志 |

---

## 二、准备工作

### 2.1 启动系统

**第一步：打开命令行**

1. 按 `Win + R` 打开运行对话框
2. 输入 `cmd` 并按回车

**第二步：启动Web服务器**

在命令行中输入：

```bash
cd D:\CTP\ctp_trading_system
python -m web.app
```

**第三步：打开浏览器**

1. 打开浏览器（推荐Chrome或Edge）
2. 在地址栏输入：`http://localhost:8000`
3. 按回车，即可看到系统界面

### 2.2 检查网络环境

> ⚠️ **重要提示**：仿真服务器位于中国境内，需要中国网络环境才能连接成功。

**如何判断网络是否正确？**
- ✅ 使用中国IP或VPN连接到中国
- ❌ 海外网络直接连接会超时

---

## 三、连接登录

连接登录是使用系统的第一步，分为三个阶段：连接服务器 → 客户端认证 → 用户登录。

### 3.1 连接服务器

**目的**：建立与CTP服务器的网络连接

**操作步骤**：

1. 点击「连接登录」标签页
2. 检查以下信息是否正确：
   - 经纪商ID：`66666`
   - 交易前置：`tcp://124.74.247.136:21407`
3. 点击「连接服务器」按钮

**成功标志**：
- "服务器连接" 状态变为 ✅ 已连接
- 右侧实时日志显示："连接成功"

---

#### 📝 实践案例1：首次连接服务器

**场景**：小王第一次使用系统，需要连接仿真服务器

**操作**：
```
1. 打开浏览器，访问 http://localhost:8000
2. 看到系统界面后，确认在「连接登录」标签页
3. 检查经纪商ID显示为 "66666"
4. 检查交易前置显示为 "tcp://124.74.247.136:21407"
5. 点击蓝色的「连接服务器」按钮
6. 等待2-3秒
```

**预期结果**：
```
✓ 按钮右侧的状态指示器变绿
✓ "服务器连接: 已连接"
✓ 「客户端认证」按钮变为可点击状态
```

**可能遇到的问题**：
| 问题 | 原因 | 解决方法 |
|------|------|----------|
| 连接超时 | 网络不在中国 | 使用VPN连接到中国 |
| 连接失败 | 服务器地址错误 | 检查交易前置地址 |

---

### 3.2 客户端认证

**目的**：验证客户端软件的合法性

**操作步骤**：

1. 确保「连接服务器」已成功
2. 检查以下信息：
   - 投资者账号：`88003785`
   - AppID：`client_mltrader_1.0.0`
   - 授权码：`L8QDUC6XHBQR7WK2`
3. 点击「客户端认证」按钮

**成功标志**：
- "客户端认证" 状态变为 ✅ 已认证
- 「用户登录」按钮变为可点击

---

#### 📝 实践案例2：完成客户端认证

**场景**：小王已连接服务器，需要进行客户端认证

**操作**：
```
1. 确认投资者账号显示为 "88003785"
2. 确认AppID显示为 "client_mltrader_1.0.0"
3. 确认授权码显示为 "L8QDUC6XHBQR7WK2"
4. 点击蓝色的「客户端认证」按钮
5. 等待1-2秒
```

**预期结果**：
```
✓ "客户端认证: 已认证"
✓ 「用户登录」按钮从灰色变为绿色可点击
```

**可能遇到的问题**：
| 问题 | 原因 | 解决方法 |
|------|------|----------|
| 认证失败(错误63) | AppID或授权码错误 | 检查是否与经纪商ID匹配 |
| 认证失败 | 未填写投资者账号 | 填写正确的账号 |

---

### 3.3 用户登录

**目的**：使用账号密码登录交易系统

**操作步骤**：

1. 确保「客户端认证」已成功
2. 输入密码：`Ctp123456`
3. 点击「用户登录」按钮

**成功标志**：
- "用户登录" 状态变为 ✅ 已登录
- 顶部导航栏状态变为绿色 "已连接"
- 系统自动加载合约列表

---

#### 📝 实践案例3：完成用户登录

**场景**：小王已完成认证，需要登录系统

**操作**：
```
1. 在密码输入框中输入 "Ctp123456"
2. 点击绿色的「用户登录」按钮
3. 等待3-5秒（系统正在加载合约列表）
```

**预期结果**：
```
✓ "用户登录: 已登录"
✓ 顶部导航栏显示绿色 "已连接"
✓ 右侧日志显示 "登录成功"
✓ 日志显示 "查询到 XXX 个合约"
```

**登录后系统会自动完成**：
1. 确认结算单
2. 查询可交易合约列表
3. 启动连接状态监测

---

### 3.4 完整登录流程总结

```
第1步                    第2步                    第3步
┌──────────┐            ┌──────────┐            ┌──────────┐
│ 连接服务器 │ ────────▶ │ 客户端认证 │ ────────▶ │ 用户登录  │
└──────────┘            └──────────┘            └──────────┘
     │                       │                       │
     ▼                       ▼                       ▼
  检查地址                检查AppID              输入密码
  点击按钮                检查授权码             点击按钮
  等待连接                点击按钮               等待加载
```

---

## 四、交易操作

交易操作是系统的核心功能，包括：开仓（建立持仓）、平仓（了结持仓）、撤单（取消委托）。

### 4.1 基本概念

在开始交易前，请了解以下基本概念：

| 术语 | 解释 | 例子 |
|------|------|------|
| 合约代码 | 期货合约的唯一标识 | IF2401（沪深300股指期货2024年1月合约） |
| 开仓 | 新建持仓 | 买入1手IF2401 |
| 平仓 | 了结已有持仓 | 卖出之前买入的1手IF2401 |
| 买入 | 做多方向 | 预期价格上涨时买入 |
| 卖出 | 做空方向 | 预期价格下跌时卖出 |
| 撤单 | 取消未成交的委托 | 取消挂单中的买入委托 |

### 4.2 开仓操作

**功能位置**：交易操作 → 买入开仓 / 卖出开仓

**界面说明**：
```
┌────────────────────────────────────────────────────┐
│  合约代码        价格              数量            │
│  ┌──────────┐   ┌──────────┐     ┌──────────┐    │
│  │ IF2401   │   │ 3500.00  │     │    1     │    │
│  └──────────┘   └──────────┘     └──────────┘    │
│                                                    │
│  ┌──────────────┐  ┌──────────────┐              │
│  │  买入开仓    │  │  卖出开仓    │              │
│  │  (红色按钮)  │  │  (绿色按钮)  │              │
│  └──────────────┘  └──────────────┘              │
└────────────────────────────────────────────────────┘
```

---

#### 📝 实践案例4：买入开仓（做多）

**场景**：小王认为沪深300指数会上涨，想买入1手IF2401合约

**操作步骤**：
```
1. 点击「交易操作」标签页
2. 在"合约代码"输入框中输入：IF2401
3. 在"价格"输入框中输入：3500.00
4. 在"数量"输入框中保持：1
5. 点击红色的「买入开仓」按钮
```

**预期结果**：
```
✓ 弹出提示："报单已提交"
✓ 下方"当前委托"表格中出现一条新记录
✓ 右侧"实时状态"报单数变为 1
✓ 右侧"实时日志"显示开仓报单信息
```

**当前委托表格显示**：
| 委托号 | 合约 | 方向 | 开平 | 价格 | 数量 | 状态 | 操作 |
|--------|------|------|------|------|------|------|------|
| 000001 | IF2401 | 买 | 开 | 3500.00 | 1 | 未成交 | [撤单] |

---

#### 📝 实践案例5：卖出开仓（做空）

**场景**：小王认为沪深300指数会下跌，想卖出1手IF2401合约

**操作步骤**：
```
1. 点击「交易操作」标签页
2. 在"合约代码"输入框中输入：IF2401
3. 在"价格"输入框中输入：3600.00
4. 在"数量"输入框中保持：1
5. 点击绿色的「卖出开仓」按钮
```

**预期结果**：
```
✓ 弹出提示："报单已提交"
✓ 当前委托表格新增一条"卖出开仓"记录
```

---

### 4.3 平仓操作

**功能位置**：交易操作 → 买入平仓 / 卖出平仓

**什么时候用平仓？**
- 买入平仓：用于平掉之前的**卖出开仓**（空头持仓）
- 卖出平仓：用于平掉之前的**买入开仓**（多头持仓）

---

#### 📝 实践案例6：卖出平仓（平多头）

**场景**：小王之前买入了1手IF2401，现在想平掉这个多头持仓

**操作步骤**：
```
1. 点击「交易操作」标签页
2. 在"合约代码"输入框中输入：IF2401
3. 在"价格"输入框中输入：3550.00（比买入价高，盈利平仓）
4. 在"数量"输入框中输入：1
5. 点击绿色边框的「卖出平仓」按钮
```

**预期结果**：
```
✓ 弹出提示："报单已提交"
✓ 当前委托表格新增一条"卖出平仓"记录
✓ 若价格合适，委托状态会变为"已成交"
```

---

#### 📝 实践案例7：买入平仓（平空头）

**场景**：小王之前卖出了1手IF2401，现在想平掉这个空头持仓

**操作步骤**：
```
1. 点击「交易操作」标签页
2. 在"合约代码"输入框中输入：IF2401
3. 在"价格"输入框中输入：3550.00
4. 在"数量"输入框中输入：1
5. 点击红色边框的「买入平仓」按钮
```

---

### 4.4 撤单操作

**功能位置**：交易操作 → 当前委托表格 → 撤单按钮

**什么时候需要撤单？**
- 委托价格不合适，想重新报单
- 不想继续等待成交
- 策略改变，取消之前的委托

---

#### 📝 实践案例8：撤销未成交委托

**场景**：小王之前提交了一笔买入委托，但一直未成交，想撤销

**操作步骤**：
```
1. 在「交易操作」标签页
2. 找到下方"当前委托"表格
3. 找到要撤销的委托（状态为"未成交"）
4. 点击该行最右侧的「撤单」按钮
```

**预期结果**：
```
✓ 弹出提示："撤单已提交"
✓ 委托状态变为"撤单中"
✓ 最终状态变为"已撤销"
✓ 右侧"实时状态"撤单数+1
```

**委托状态变化流程**：
```
未成交 ──点击撤单──▶ 撤单中 ──撤单成功──▶ 已撤销
```

---

### 4.5 交易操作注意事项

| 注意事项 | 说明 |
|----------|------|
| 合约代码必须正确 | 输入不存在的合约会被系统拒绝 |
| 价格必须符合规则 | 价格必须是最小变动单位的整数倍 |
| 数量必须为正整数 | 不能输入0或负数 |
| 平仓需要有持仓 | 没有持仓无法平仓 |
| 非交易时间无法交易 | 只能在交易时段内操作 |

---

## 五、监测面板

监测面板用于实时查看系统状态和交易统计。

### 5.1 连接状态监测

**功能位置**：监测面板 → 连接状态监测

**显示内容**：
```
┌────────────────────────────────────────────────────┐
│  连接状态监测                          [第5项]     │
├────────────────────────────────────────────────────┤
│                                                    │
│  状态: [已连接]    心跳时间: 12:30:45             │
│                                                    │
│  断线次数: 0       重连次数: 0                    │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

#### 📝 实践案例9：检查连接状态

**场景**：小王想确认系统与服务器的连接是否正常

**操作步骤**：
```
1. 点击「监测面板」标签页
2. 查看"连接状态监测"区域
3. 观察以下指标：
   - 状态：应显示"已连接"（绿色）
   - 心跳时间：应该是最近几秒内的时间
   - 断线次数：正常情况下为0
```

**如何判断连接正常？**
- ✅ 状态显示"已连接"
- ✅ 心跳时间在5秒内更新
- ✅ 断线次数为0

**如何判断连接异常？**
- ❌ 状态显示"已断开"
- ❌ 心跳时间停止更新
- ❌ 断线次数不断增加

---

### 5.2 报单统计监测

**功能位置**：监测面板 → 报单监测

**显示内容**：
```
┌────────────────────────────────────────────────────┐
│  报单监测                            [第6-8项]     │
├────────────────────────────────────────────────────┤
│                                                    │
│  合约      开仓次数    平仓次数    撤单次数       │
│  ───────────────────────────────────────────────  │
│  IF2401      5           3           2            │
│  IC2401      2           1           0            │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

#### 📝 实践案例10：查看交易统计

**场景**：小王想知道今天在IF2401合约上进行了多少次交易

**操作步骤**：
```
1. 点击「监测面板」标签页
2. 找到"报单监测"区域的表格
3. 在"合约"列找到 IF2401
4. 查看该行的开仓次数、平仓次数、撤单次数
```

**预期结果**：
```
假设小王今天在IF2401上：
- 开仓了5次
- 平仓了3次
- 撤单了2次

表格会显示：IF2401 | 5 | 3 | 2
```

---

### 5.3 账号统计监测

**功能位置**：监测面板 → 账号统计

**显示内容**：
```
┌────────────────────────────────────────────────────┐
│  账号统计                           [第9-10项]     │
├────────────────────────────────────────────────────┤
│                                                    │
│    ┌────────────┐        ┌────────────┐           │
│    │     15     │        │      3     │           │
│    │ 今日报单总数│        │ 今日撤单总数│           │
│    └────────────┘        └────────────┘           │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

#### 📝 实践案例11：监控账号交易总量

**场景**：小王想确认今天的总交易笔数是否接近上限

**操作步骤**：
```
1. 点击「监测面板」标签页
2. 查看"账号统计"区域
3. 关注"今日报单总数"和"今日撤单总数"
```

**阈值提醒**：
- 报单总数上限：500笔（默认）
- 撤单总数上限：400笔（默认）
- 接近上限时会触发预警

---

## 六、阈值设置

阈值设置用于配置交易上限和预警条件。

### 6.1 单合约阈值

**功能位置**：阈值设置 → 重复报单阈值

**可设置项目**：
| 阈值类型 | 默认值 | 说明 |
|----------|--------|------|
| 单合约开仓次数上限 | 10 | 同一合约最多开仓10次 |
| 单合约平仓次数上限 | 10 | 同一合约最多平仓10次 |
| 单合约撤单次数上限 | 10 | 同一合约最多撤单10次 |

---

#### 📝 实践案例12：设置单合约交易上限

**场景**：小王想限制每个合约最多只能开仓5次，防止过度交易

**操作步骤**：
```
1. 点击「阈值设置」标签页
2. 找到"重复报单阈值"区域
3. 将"单合约开仓次数上限"从10改为5
4. 点击「保存阈值设置」按钮
```

**预期结果**：
```
✓ 弹出提示："阈值设置已保存"
✓ 当任一合约开仓达到5次时，系统会发出预警
```

---

### 6.2 总量阈值

**功能位置**：阈值设置 → 总量阈值

**可设置项目**：
| 阈值类型 | 默认值 | 说明 |
|----------|--------|------|
| 报单总数上限 | 500 | 账号今日最多报单500笔 |
| 撤单总数上限 | 400 | 账号今日最多撤单400笔 |

---

#### 📝 实践案例13：设置账号交易上限

**场景**：小王想将报单上限调整为200笔

**操作步骤**：
```
1. 点击「阈值设置」标签页
2. 找到"总量阈值"区域
3. 将"报单总数上限"从500改为200
4. 点击「保存阈值设置」按钮
```

**预期结果**：
```
✓ 弹出提示："阈值设置已保存"
✓ 当报单总数达到200笔时，系统会发出预警
```

---

### 6.3 预警方式配置

**功能位置**：阈值设置 → 预警方式配置

**可选预警方式**：
- [x] 弹窗提示（默认开启）
- [x] 声音提示（默认开启）
- [ ] 短信通知（需配置）
- [ ] 邮件通知（需配置）

---

#### 📝 实践案例14：配置预警通知方式

**场景**：小王想同时启用弹窗和声音预警

**操作步骤**：
```
1. 点击「阈值设置」标签页
2. 找到"预警方式配置"区域
3. 勾选"弹窗提示"和"声音提示"
4. 取消勾选不需要的通知方式
```

**预警触发时**：
```
✓ 屏幕弹出预警对话框
✓ 播放提示音
✓ 预警消息面板显示预警记录
```

---

### 6.4 查看预警历史

**功能位置**：阈值设置 → 预警历史

---

#### 📝 实践案例15：触发并查看预警

**场景**：小王想测试预警功能是否正常工作

**操作步骤**：
```
1. 设置单合约开仓上限为3
2. 对同一合约（如IF2401）进行4次开仓操作
3. 第4次开仓时触发预警
4. 在"预警历史"表格中查看预警记录
```

**预警历史显示**：
| 时间 | 级别 | 类型 | 消息 |
|------|------|------|------|
| 12:30:45 | WARNING | 重复开仓 | IF2401单合约开仓次数达到阈值: 3/3 |

---

## 七、错误防范测试

错误防范测试用于验证系统的安全检查功能。

### 7.1 测试功能列表

| 测试项 | 评估表项号 | 测试内容 |
|--------|------------|----------|
| 合约代码错误检查 | 第14项 | 输入无效合约代码 |
| 价格最小变动检查 | 第15项 | 输入不符合变动单位的价格 |
| 委托数量检查 | 第16项 | 输入无效数量 |
| 资金不足提示 | 第17项 | 测试保证金检查 |
| 持仓不足提示 | 第18项 | 测试平仓时持仓检查 |
| 非交易时间提示 | 第19项 | 测试交易时间检查 |

---

#### 📝 实践案例16：测试合约代码检查

**场景**：小王想验证系统是否能识别无效的合约代码

**操作步骤**：
```
1. 点击「错误防范测试」标签页
2. 找到"合约代码错误检查"一行
3. 点击右侧的「测试」按钮
4. 观察测试结果
```

**预期结果**：
```
✓ 测试结果标签变为"✓ 通过"（绿色）
✓ 下方"错误提示信息"区域显示：
  "合约代码无效: INVALID_CODE"
```

**这说明什么？**
- 系统能够正确识别无效的合约代码
- 当用户输入错误合约时，系统会给出明确提示

---

#### 📝 实践案例17：测试价格检查

**场景**：小王想验证系统是否能检查价格是否符合最小变动单位

**操作步骤**：
```
1. 点击「错误防范测试」标签页
2. 找到"价格最小变动检查"一行
3. 点击右侧的「测试」按钮
4. 观察测试结果
```

**预期结果**：
```
✓ 测试结果标签变为"✓ 通过"（绿色）
✓ 错误提示显示："价格不符合最小变动单位"
```

**知识点**：
- 股指期货（IF）最小变动单位是0.2点
- 价格必须是0.2的整数倍（如3500.0, 3500.2, 3500.4...）
- 输入3500.1这样的价格会被系统拒绝

---

#### 📝 实践案例18：完整测试所有错误防范功能

**场景**：小王想一次性测试所有6项错误防范功能

**操作步骤**：
```
1. 点击「错误防范测试」标签页
2. 从上到下依次点击每一项的「测试」按钮：
   - 合约代码错误检查 → 点击测试
   - 价格最小变动检查 → 点击测试
   - 委托数量检查 → 点击测试
   - 资金不足提示 → 点击测试
   - 持仓不足提示 → 点击测试
   - 非交易时间提示 → 点击测试
3. 确认每一项都显示"✓ 通过"
```

**预期结果**：
```
┌────────────────────────────────────────────────────┐
│  合约代码错误检查     [第14项]    ✓ 通过   [测试] │
│  价格最小变动检查     [第15项]    ✓ 通过   [测试] │
│  委托数量检查         [第16项]    ✓ 通过   [测试] │
│  资金不足提示         [第17项]    ✓ 通过   [测试] │
│  持仓不足提示         [第18项]    ✓ 通过   [测试] │
│  非交易时间提示       [第19项]    ✓ 通过   [测试] │
└────────────────────────────────────────────────────┘
```

---

## 八、应急处置

应急处置用于紧急情况下快速控制风险。

### 8.1 功能概览

| 功能 | 评估表项号 | 作用 |
|------|------------|------|
| 暂停交易 | 第20项 | 禁止所有新报单 |
| 恢复交易 | - | 恢复正常交易 |
| 按合约撤单 | 第23项 | 撤销指定合约的所有委托 |
| 全部撤单 | 第24项 | 撤销所有未成交委托 |
| 一键紧急停止 | 第20项 | 暂停+停止策略+全部撤单 |

---

### 8.2 暂停交易

**功能位置**：应急处置 → 暂停交易功能 → 暂停交易

---

#### 📝 实践案例19：暂停和恢复交易

**场景**：小王发现市场异常波动，想暂时停止交易

**操作步骤（暂停）**：
```
1. 点击「应急处置」标签页
2. 找到"暂停交易功能"区域
3. 点击黄色的「暂停交易」按钮
4. 观察状态变化
```

**暂停后的状态**：
```
✓ 当前状态：变为"已暂停"（黄色标签）
✓ 底部状态栏：交易状态变为"已暂停"
✓ 所有新的报单请求会被拒绝
```

**操作步骤（恢复）**：
```
1. 确认风险已经解除
2. 点击绿色的「恢复交易」按钮
3. 观察状态恢复为"交易中"
```

**恢复后的状态**：
```
✓ 当前状态：变为"交易中"（绿色标签）
✓ 可以正常提交报单
```

---

### 8.3 批量撤单

**功能位置**：应急处置 → 批量撤单功能

---

#### 📝 实践案例20：按合约撤单

**场景**：小王有多笔IF2401的委托，想一次性全部撤销

**操作步骤**：
```
1. 点击「应急处置」标签页
2. 找到"批量撤单功能"区域
3. 在"按合约撤单"输入框中输入：IF2401
4. 点击「部分撤单」按钮
```

**预期结果**：
```
✓ 弹出提示："部分撤单完成，成功3/3"
✓ 所有IF2401的未成交委托都被撤销
✓ 其他合约的委托不受影响
```

---

#### 📝 实践案例21：全部撤单

**场景**：小王想撤销所有未成交的委托

**操作步骤**：
```
1. 点击「应急处置」标签页
2. 找到"批量撤单功能"区域
3. 点击红色的「全部撤单」按钮
4. 确认操作
```

**预期结果**：
```
✓ 弹出提示："全部撤单完成，成功6/6"
✓ 所有未成交委托都被撤销
✓ 委托表格清空
```

---

### 8.4 一键紧急停止

**功能位置**：应急处置 → 紧急停止 → 一键紧急停止

> ⚠️ **警告**：这是最严重的应急操作，会同时执行：暂停交易 + 停止策略 + 全部撤单

---

#### 📝 实践案例22：执行紧急停止

**场景**：小王发现系统异常，需要立即停止所有交易活动

**操作步骤**：
```
1. 点击「应急处置」标签页
2. 找到"紧急停止"区域（红色边框）
3. 点击红色的「一键紧急停止」按钮
4. 系统自动执行以下操作：
   - 暂停交易
   - 停止策略执行
   - 撤销所有未成交委托
```

**预期结果**：
```
✓ 弹出严重预警对话框
✓ 系统状态变为"已暂停"+"应急模式"
✓ 所有委托被撤销
✓ 日志记录紧急停止事件
```

**恢复方法**：
```
1. 分析问题原因
2. 确认问题已解决
3. 点击「恢复交易」按钮
```

---

## 九、日志查看

日志查看用于查询系统运行记录，便于问题排查和交易复盘。

### 9.1 日志类型

| 日志类型 | 颜色 | 内容 |
|----------|------|------|
| TRADE | 蓝色 | 交易相关：报单、撤单、成交 |
| SYSTEM | 灰色 | 系统相关：连接、认证、登录 |
| MONITOR | 绿色 | 监测相关：阈值检查、状态监测 |
| ALERT | 黄色 | 预警相关：各类预警事件 |
| ERROR | 红色 | 错误相关：各类异常和错误 |

### 9.2 日志级别

| 级别 | 含义 | 示例 |
|------|------|------|
| DEBUG | 调试信息 | 内部处理细节 |
| INFO | 一般信息 | 正常操作记录 |
| WARNING | 警告信息 | 阈值预警、异常情况 |
| ERROR | 错误信息 | 操作失败、系统错误 |
| CRITICAL | 严重错误 | 紧急停止、系统崩溃 |

---

#### 📝 实践案例23：查看交易日志

**场景**：小王想查看今天所有的交易记录

**操作步骤**：
```
1. 点击「日志查看」标签页
2. 在"日志类型"下拉框中选择"TRADE"（交易日志）
3. 在"日志级别"下拉框中选择"ALL"（全部级别）
4. 点击「刷新」按钮
```

**预期结果**：
```
日志容器中显示所有交易相关的日志：

12:30:45 [INFO] 开仓报单已提交: IF2401 buy 1@3500.00
12:30:42 [INFO] 撤单已提交: IF2401 order_ref=000001
12:30:40 [INFO] 开仓成交: IF2401 buy 1@3500.00
...
```

---

#### 📝 实践案例24：查看错误日志

**场景**：小王发现有操作失败了，想查看具体错误

**操作步骤**：
```
1. 点击「日志查看」标签页
2. 在"日志类型"下拉框中选择"ERROR"（错误日志）
3. 点击「刷新」按钮
4. 查看红色的错误日志
```

**预期结果**：
```
12:31:20 [ERROR] 报单失败: 合约代码无效
12:30:55 [ERROR] 平仓失败: 持仓不足
...
```

---

#### 📝 实践案例25：导出日志文件

**场景**：小王想保存今天的日志用于复盘分析

**操作步骤**：
```
1. 点击「日志查看」标签页
2. 选择需要导出的日志类型
3. 点击「导出」按钮
4. 浏览器会下载日志文件
```

**导出的文件**：
- 文件名：`trade_2025-01-15.log`
- 格式：UTF-8编码的文本文件
- 可用记事本或其他编辑器打开

---

## 十、常见问题解答

### Q1：连接服务器失败怎么办？

**可能原因**：
1. 网络不在中国境内
2. 服务器地址输入错误
3. 仿真服务器维护中

**解决方法**：
```
1. 确认使用中国网络或VPN
2. 检查服务器地址：tcp://124.74.247.136:21407
3. 联系期货公司确认服务器状态
```

---

### Q2：客户端认证失败（错误63）怎么办？

**可能原因**：
1. AppID或授权码与经纪商不匹配
2. 投资者账号未填写

**解决方法**：
```
1. 确认使用正确的AppID：client_mltrader_1.0.0
2. 确认使用正确的授权码：L8QDUC6XHBQR7WK2
3. 确保投资者账号已填写：88003785
4. 强制刷新浏览器：Ctrl+Shift+R
```

---

### Q3：登录失败怎么办？

**可能原因**：
1. 密码错误
2. 账号被禁用
3. 未完成客户端认证

**解决方法**：
```
1. 确认密码正确：Ctp123456
2. 联系期货公司确认账号状态
3. 先完成客户端认证再登录
```

---

### Q4：报单被拒绝怎么办？

**可能原因及解决方法**：

| 错误提示 | 原因 | 解决方法 |
|----------|------|----------|
| 合约代码无效 | 输入了不存在的合约 | 输入正确的合约代码 |
| 价格不符合规定 | 价格不是最小变动单位的整数倍 | 调整价格 |
| 数量无效 | 输入了0或负数 | 输入正整数 |
| 保证金不足 | 账户资金不够 | 减少数量或入金 |
| 持仓不足 | 平仓数量超过持仓 | 减少平仓数量 |
| 非交易时间 | 不在交易时段内 | 等待交易时间 |

---

### Q5：交易时间是什么时候？

**期货交易时间（北京时间）**：

| 时段 | 时间 |
|------|------|
| 日盘上午第一节 | 09:00 - 10:15 |
| 日盘上午第二节 | 10:30 - 11:30 |
| 日盘下午 | 13:30 - 15:00 |
| 夜盘 | 21:00 - 次日02:30 |

---

### Q6：如何查看我的持仓？

**方法**：
```
1. 登录成功后，查看「交易操作」标签页
2. 持仓信息会显示在"当前持仓"表格中
3. 也可以通过API查询：GET /api/trading/positions
```

---

### Q7：系统卡住了怎么办？

**解决方法**：
```
1. 刷新浏览器页面：按F5
2. 强制刷新：Ctrl+Shift+R
3. 重启服务器：
   - 关闭命令行窗口
   - 重新运行：python -m web.app
4. 重新打开浏览器访问
```

---

### Q8：如何完全退出系统？

**步骤**：
```
1. 点击「应急处置」→「全部撤单」（确保没有遗留委托）
2. 关闭浏览器窗口
3. 在命令行窗口按 Ctrl+C 停止服务器
```

---

## 附录A：快捷操作速查表

| 操作 | 位置 | 快捷步骤 |
|------|------|----------|
| 连接登录 | 连接登录 | 连接→认证→登录 |
| 买入开仓 | 交易操作 | 输入合约、价格、数量→买入开仓 |
| 卖出开仓 | 交易操作 | 输入合约、价格、数量→卖出开仓 |
| 撤单 | 交易操作 | 在委托表格点击撤单按钮 |
| 暂停交易 | 应急处置 | 点击暂停交易按钮 |
| 全部撤单 | 应急处置 | 点击全部撤单按钮 |
| 紧急停止 | 应急处置 | 点击一键紧急停止按钮 |
| 查看日志 | 日志查看 | 选择类型→刷新 |

---

## 附录B：评估表对照表

| 项号 | 评价项目 | 级别 | 对应功能 |
|------|----------|------|----------|
| 1 | 接口适应性 | 严重 | 连接登录 |
| 2 | 开仓指令 | 严重 | 买入/卖出开仓 |
| 3 | 平仓指令 | 严重 | 买入/卖出平仓 |
| 4 | 撤单指令 | 严重 | 撤单按钮 |
| 5 | 连接状态监测 | 严重 | 监测面板-连接状态 |
| 6 | 单合约开仓监测 | 建议 | 监测面板-报单监测 |
| 7 | 单合约平仓监测 | 建议 | 监测面板-报单监测 |
| 8 | 单合约撤单监测 | 建议 | 监测面板-报单监测 |
| 9 | 报单总数监测 | 严重 | 监测面板-账号统计 |
| 10 | 撤单总数监测 | 严重 | 监测面板-账号统计 |
| 11 | 重复报单阈值 | 建议 | 阈值设置-重复报单 |
| 12 | 报单总数阈值 | 严重 | 阈值设置-总量阈值 |
| 13 | 撤单总数阈值 | 严重 | 阈值设置-总量阈值 |
| 14 | 合约代码检查 | 严重 | 错误防范测试 |
| 15 | 价格变动检查 | 严重 | 错误防范测试 |
| 16 | 数量检查 | 严重 | 错误防范测试 |
| 17 | 资金检查 | 严重 | 错误防范测试 |
| 18 | 持仓检查 | 严重 | 错误防范测试 |
| 19 | 交易时间检查 | 严重 | 错误防范测试 |
| 20 | 暂停交易 | 严重 | 应急处置-暂停交易 |
| 21-22 | 预警方式 | 混合 | 阈值设置-预警配置 |
| 23 | 按合约撤单 | 建议 | 应急处置-部分撤单 |
| 24 | 全部撤单 | 建议 | 应急处置-全部撤单 |
| 25 | 日志记录 | 严重 | 日志查看 |

---

## 版本历史

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0.0 | 2025-01-15 | 初始版本 |

---

> 📞 如有问题，请联系技术支持或查看项目GitHub仓库：https://github.com/ByteBard/CTP
