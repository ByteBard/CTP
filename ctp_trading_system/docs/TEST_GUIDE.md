# CTP程序化交易系统功能测试指南

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | CTP程序化交易系统功能测试指南 |
| 适用标准 | T/ZQX 0004-2025《期货程序化交易系统功能测试指引》 |
| 版本 | 1.0 |
| 更新日期 | 2026-01-10 |

---

## 目录

1. [测试环境准备](#一测试环境准备)
2. [系统启动](#二系统启动)
3. [Web界面说明](#三web界面说明)
4. [评估项目测试指南](#四评估项目测试指南)
   - [第1项：接口适应性测试](#第1项接口适应性测试严重)
   - [第2-4项：基础交易功能测试](#第2-4项基础交易功能测试严重)
   - [第5项：连接状态监测测试](#第5项连接状态监测测试严重)
   - [第6-8项：重复报单监测测试](#第6-8项重复报单监测测试建议)
   - [第9-10项：报撤单笔数监测测试](#第9-10项报撤单笔数监测测试严重)
   - [第11项：重复报单阈值及预警测试](#第11项重复报单阈值及预警测试建议)
   - [第12项：报单总笔数阈值及预警测试](#第12项报单总笔数阈值及预警测试严重)
   - [第13项：撤单总笔数阈值及预警测试](#第13项撤单总笔数阈值及预警测试严重)
   - [第14-19项：错误防范测试](#第14-19项错误防范测试严重)
   - [第20项：暂停交易功能测试](#第20项暂停交易功能测试严重)
   - [第23-24项：批量撤单功能测试](#第23-24项批量撤单功能测试建议)
   - [第25项：日志记录功能测试](#第25项日志记录功能测试严重)
5. [自动化测试](#五自动化测试)
6. [常见问题](#六常见问题)
7. [附录](#七附录)

---

## 一、测试环境准备

### 1.1 系统要求

| 项目 | 最低要求 | 推荐配置 |
|------|----------|----------|
| 操作系统 | Windows 10 / Linux / macOS | Windows 10/11 64位 |
| Python版本 | 3.8+ | 3.10+ |
| 内存 | 4GB | 8GB+ |
| 磁盘空间 | 500MB | 1GB+ |
| 网络 | 可访问CTP测试服务器 | 稳定网络连接 |

### 1.2 安装依赖

```bash
# 进入项目目录
cd ctp_trading_system

# 安装Python依赖
pip install -r requirements.txt

# 安装Playwright浏览器（用于自动化测试）
playwright install chromium
```

### 1.3 CTP测试账号

测试前请准备以下信息：

| 配置项 | 说明 | 示例值 |
|--------|------|--------|
| 经纪商ID | BrokerID | 9999 |
| 交易前置地址 | TradeFront | tcp://180.168.146.187:10201 |
| 投资者账号 | InvestorID | 您的测试账号 |
| 密码 | Password | 您的密码 |
| AppID | 客户端认证ID | （如需要） |
| AuthCode | 客户端认证码 | （如需要） |

> **注意**: 建议使用SimNow模拟账号进行测试，避免在真实环境中产生风险。
> SimNow注册地址: https://www.simnow.com.cn/

---

## 二、系统启动

### 2.1 启动Web服务

```bash
# 方式1：直接启动
cd ctp_trading_system
python -m web.app

# 方式2：使用uvicorn启动（推荐）
cd ctp_trading_system
uvicorn web.app:app --host 0.0.0.0 --port 8000 --reload
```

### 2.2 访问测试界面

启动成功后，在浏览器中访问：

```
http://localhost:8000
```

### 2.3 启动确认

成功启动后，您将看到以下界面：

```
┌────────────────────────────────────────────────────────────────┐
│  CTP程序化交易系统 - 功能测试平台          [系统状态: ● 未连接]  │
├────────────────────────────────────────────────────────────────┤
│  [连接登录] [交易操作] [监测面板] [阈值设置] [错误防范] [应急] [日志] │
└────────────────────────────────────────────────────────────────┘
```

---

## 三、Web界面说明

### 3.1 界面布局

```
┌──────────────────────────────────────────────────────────────────────┐
│                           顶部导航栏                                  │
│  系统名称                                          系统状态指示器      │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─ 左侧主功能区 (8个标签页) ─────────────────┐ ┌─ 右侧状态区 ──────┐ │
│  │                                           │ │                   │ │
│  │  [连接登录] - 评估表第1项                   │ │  实时状态         │ │
│  │  [交易操作] - 评估表第2-4项                 │ │  - 报单数         │ │
│  │  [监测面板] - 评估表第5-10项                │ │  - 撤单数         │ │
│  │  [阈值设置] - 评估表第11-13项               │ │  - 交易状态       │ │
│  │  [错误防范测试] - 评估表第14-19项           │ │  - 阈值状态       │ │
│  │  [应急处置] - 评估表第20, 23-24项           │ │                   │ │
│  │  [日志查看] - 评估表第25项                  │ │  实时日志         │ │
│  │                                           │ │                   │ │
│  └───────────────────────────────────────────┘ │  预警消息         │ │
│                                                 └───────────────────┘ │
├──────────────────────────────────────────────────────────────────────┤
│                           底部状态栏                                  │
│  报单: 0  撤单: 0  │  阈值状态: 正常  │  交易状态: 允许交易           │
└──────────────────────────────────────────────────────────────────────┘
```

### 3.2 标签页与评估项对应关系

| 标签页 | 评估项 | 问题等级 |
|--------|--------|----------|
| 连接登录 | 第1项 | 严重 |
| 交易操作 | 第2-4项 | 严重 |
| 监测面板 | 第5-10项 | 严重/建议 |
| 阈值设置 | 第11-13项 | 严重/建议 |
| 错误防范测试 | 第14-19项 | 严重 |
| 应急处置 | 第20, 23-24项 | 严重/建议 |
| 日志查看 | 第25项 | 严重 |

---

## 四、评估项目测试指南

### 第1项：接口适应性测试（严重）

#### 评估要求
- 是否具备与交易系统的认证功能
- 是否能正常登录系统并能正常登录期货公司交易信息系统

#### 测试步骤

**步骤1：连接服务器**

1. 打开【连接登录】标签页
2. 填写连接信息：
   - 经纪商ID: `9999`（SimNow）
   - 交易前置: `tcp://180.168.146.187:10201`
3. 点击【连接服务器】按钮
4. 观察连接状态变化

**预期结果**:
- 服务器连接状态显示"已连接"
- 状态指示器变为绿色

**步骤2：客户端认证**

1. 连接成功后，【客户端认证】按钮变为可用
2. 点击【客户端认证】按钮
3. 等待认证完成

**预期结果**:
- 客户端认证状态显示"已认证"

**步骤3：用户登录**

1. 填写登录信息：
   - 投资者账号: 您的账号
   - 密码: 您的密码
2. 点击【用户登录】按钮
3. 等待登录完成

**预期结果**:
- 用户登录状态显示"已登录"
- 顶部系统状态变为"已连接"（绿色）

#### 注意事项
- SimNow在非交易时间可能无法登录
- 首次登录可能需要修改密码
- 确保网络可访问CTP服务器

---

### 第2-4项：基础交易功能测试（严重）

#### 评估要求
- 第2项：是否能正常下开仓指令
- 第3项：是否能正常下平仓指令
- 第4项：是否能正常下撤单指令

#### 测试前准备
- 确保已完成登录（第1项测试通过）
- 确保账户有足够的可用资金

#### 第2项：开仓指令测试

**测试步骤**:

1. 打开【交易操作】标签页
2. 填写交易信息：
   - 合约代码: `IF2401`（或当前主力合约）
   - 价格: 当前市价或限价
   - 数量: `1`
3. 点击【买入开仓】或【卖出开仓】按钮

**预期结果**:
- 委托表格中出现新的订单记录
- 订单状态显示"未成交"或"部分成交"或"全部成交"
- 右侧实时日志显示报单信息

#### 第3项：平仓指令测试

**测试步骤**:

1. 确保有持仓（先执行开仓）
2. 填写交易信息：
   - 合约代码: 持仓合约
   - 价格: 市价或限价
   - 数量: 持仓数量
3. 点击【买入平仓】或【卖出平仓】按钮

**预期结果**:
- 委托表格中出现平仓订单
- 订单正常处理

#### 第4项：撤单指令测试

**测试步骤**:

1. 先下一个限价单（价格远离市价，确保不会成交）
2. 在委托表格中找到该订单
3. 点击订单行的【撤单】按钮

**预期结果**:
- 订单状态变为"已撤"或"撤单中"
- 右侧日志显示撤单信息

#### 注意事项
- 测试时使用远离市价的限价单，避免意外成交
- 撤单只能对未成交或部分成交的订单执行
- 注意交易时间限制

---

### 第5项：连接状态监测测试（严重）

#### 评估要求
- 是否能正常监测到启动、正常运行、断开、重连的连接状态

#### 测试步骤

**步骤1：查看监测面板**

1. 打开【监测面板】标签页
2. 查看"连接状态监测"区域

**预期结果**:
- 显示当前连接状态（已连接/未连接/重连中等）
- 显示心跳时间
- 显示断线次数

**步骤2：测试断线重连**

1. 断开网络连接（或等待服务器断开）
2. 观察状态变化
3. 恢复网络连接
4. 观察自动重连过程

**预期结果**:
- 断开时状态变为"断开"
- 自动触发重连
- 重连成功后状态恢复为"已连接"
- 断线次数增加

#### 状态说明

| 状态 | 说明 |
|------|------|
| STARTING | 启动中 |
| CONNECTED | 已连接（正常运行） |
| DISCONNECTED | 断开连接 |
| RECONNECTING | 重连中 |
| AUTHENTICATED | 已认证 |
| LOGGED_IN | 已登录 |
| ERROR | 错误 |

---

### 第6-8项：重复报单监测测试（建议）

#### 评估要求
- 第6项：是否能正常监测单合约重复开仓交易指令数量
- 第7项：是否能正常监测单合约重复平仓交易指令数量
- 第8项：是否能正常监测单合约重复撤单交易指令数量

#### 测试步骤

**步骤1：执行多次相同操作**

1. 打开【交易操作】标签页
2. 对同一合约（如IF2401）执行多次开仓操作
3. 对同一合约执行多次平仓操作
4. 对同一合约执行多次撤单操作

**步骤2：查看监测结果**

1. 打开【监测面板】标签页
2. 查看"报单监测"区域的表格

**预期结果**:

| 合约 | 开仓次数 | 平仓次数 | 撤单次数 |
|------|----------|----------|----------|
| IF2401 | 3 | 2 | 1 |

- 每个合约的操作次数被正确统计
- 数据实时更新

---

### 第9-10项：报撤单笔数监测测试（严重）

#### 评估要求
- 第9项：是否能正常监测同一账号的报单交易指令数量
- 第10项：是否能正常监测同一账号的撤单交易指令数量

#### 测试步骤

1. 打开【监测面板】标签页
2. 查看"账号统计"区域
3. 执行若干报单和撤单操作
4. 观察统计数字变化

**预期结果**:
- "今日报单总数"实时增加
- "今日撤单总数"实时增加
- 数字与实际操作次数一致

---

### 第11项：重复报单阈值及预警测试（建议）

#### 评估要求
- 是否提供重复报单笔数的阈值设置功能
- 重复开仓/平仓/撤单单报单笔数等于或大于设置的阈值时，是否能通过弹窗提示、声音提示、短信、邮件中的一种或多种进行警示

#### 测试步骤

**步骤1：设置阈值**

1. 打开【阈值设置】标签页
2. 在"重复报单阈值"区域设置：
   - 单合约开仓次数上限: `3`
   - 单合约平仓次数上限: `3`
   - 单合约撤单次数上限: `3`
3. 点击【保存阈值设置】

**步骤2：配置预警方式**

1. 在"预警方式配置"区域勾选：
   - [x] 弹窗提示
   - [x] 声音提示
   - [ ] 短信通知（需配置）
   - [ ] 邮件通知（需配置）

**步骤3：触发预警**

1. 切换到【交易操作】
2. 对同一合约连续执行4次开仓操作
3. 观察预警触发

**预期结果**:
- 第4次操作时触发预警
- 弹出预警弹窗
- 播放预警声音
- 预警历史表格记录预警信息
- 右侧"预警消息"区域显示预警

#### 预警方式说明

| 预警方式 | 说明 | 配置要求 |
|----------|------|----------|
| 弹窗提示 | 浏览器弹窗 | 无需配置 |
| 声音提示 | 蜂鸣声 | 无需配置 |
| 短信通知 | 发送短信 | 需配置短信网关 |
| 邮件通知 | 发送邮件 | 需配置SMTP服务器 |

---

### 第12项：报单总笔数阈值及预警测试（严重）

#### 评估要求
- 是否提供报单总笔数的阈值设置功能
- 报单总笔数等于或大于设置的阈值时，是否能通过弹窗提示、声音提示、短信、邮件中的一种或多种进行警示

#### 测试步骤

**步骤1：设置阈值**

1. 打开【阈值设置】标签页
2. 在"总量阈值"区域设置：
   - 报单总数上限: `10`（测试用，实际可设更高）
3. 点击【保存阈值设置】

**步骤2：触发预警**

1. 执行多次报单操作（超过设置的阈值）
2. 观察预警触发

**预期结果**:
- 报单总数达到阈值时触发预警
- 预警通过配置的方式发出（弹窗/声音等）
- 预警历史记录该事件

---

### 第13项：撤单总笔数阈值及预警测试（严重）

#### 评估要求
- 是否提供撤单总笔数的阈值设置功能
- 撤单总笔数等于或大于设置的阈值时，是否能通过弹窗提示、声音提示、短信、邮件中的一种或多种进行警示

#### 测试步骤

**步骤1：设置阈值**

1. 打开【阈值设置】标签页
2. 在"总量阈值"区域设置：
   - 撤单总数上限: `5`（测试用）
3. 点击【保存阈值设置】

**步骤2：触发预警**

1. 下单后撤单，重复操作超过阈值次数
2. 观察预警触发

**预期结果**:
- 撤单总数达到阈值时触发预警
- 预警通过配置的方式发出

---

### 第14-19项：错误防范测试（严重）

#### 评估要求
- 第14项：当合约代码错误时，系统是否能检查出合约代码错误
- 第15项：当委托价格最小变动价位错误时，系统是否能检查出错误
- 第16项：当委托数量超出单笔最大委托手数时，系统是否能检查出错误
- 第17项：当资金不足时下达开仓指令，系统是否能显示资金不足的错误提示
- 第18项：当持仓不足时下达平仓指令，系统是否能显示持仓不足的错误提示
- 第19项：当市场状态不可用时下达交易指令，系统是否能显示非交易时间的错误提示

#### 测试步骤

1. 打开【错误防范测试】标签页
2. 依次点击各项测试按钮

#### 第14项：合约代码错误检查

**测试方法**: 点击【测试】按钮（合约代码错误检查）

**预期结果**:
- 测试结果显示"通过"
- 错误提示区显示"合约代码不存在"或类似信息

#### 第15项：价格最小变动检查

**测试方法**: 点击【测试】按钮（价格最小变动检查）

**预期结果**:
- 测试结果显示"通过"
- 错误提示区显示"价格不符合最小变动单位"或类似信息

#### 第16项：委托数量检查

**测试方法**: 点击【测试】按钮（委托数量检查）

**预期结果**:
- 测试结果显示"通过"
- 错误提示区显示"委托数量超出限制"或类似信息

#### 第17项：资金不足提示

**测试方法**: 点击【测试】按钮（资金不足提示）

**预期结果**:
- 测试结果显示"通过"
- 错误提示区显示"可用资金不足"或类似信息

#### 第18项：持仓不足提示

**测试方法**: 点击【测试】按钮（持仓不足提示）

**预期结果**:
- 测试结果显示"通过"
- 错误提示区显示"持仓不足"或类似信息

#### 第19项：非交易时间提示

**测试方法**: 点击【测试】按钮（非交易时间提示）

**预期结果**:
- 测试结果显示"通过"或"未触发"（取决于当前时间）
- 如在非交易时间，显示"非交易时间"错误提示

#### 错误代码说明

| 错误类型 | 错误代码 | 说明 |
|----------|----------|------|
| 合约代码错误 | INVALID_INSTRUMENT | 合约不存在或已过期 |
| 价格错误 | INVALID_PRICE | 不符合最小变动单位 |
| 数量错误 | INVALID_VOLUME | 超出限制或为负数 |
| 资金不足 | INSUFFICIENT_MARGIN | 可用资金不足 |
| 持仓不足 | INSUFFICIENT_POSITION | 可平仓数量不足 |
| 非交易时间 | NON_TRADING_TIME | 当前不在交易时段 |

---

### 第20项：暂停交易功能测试（严重）

#### 评估要求
- 是否能够通过限制账号权限、停止策略执行、强制退出账号等一种或多方式暂停交易

#### 测试步骤

**步骤1：暂停交易**

1. 打开【应急处置】标签页
2. 点击【暂停交易】按钮
3. 观察状态变化

**预期结果**:
- 当前状态显示"已暂停"
- 底部状态栏显示"交易暂停"

**步骤2：验证暂停效果**

1. 切换到【交易操作】
2. 尝试下单
3. 观察结果

**预期结果**:
- 无法下单
- 显示"交易已暂停"错误提示

**步骤3：恢复交易**

1. 返回【应急处置】
2. 点击【恢复交易】按钮

**预期结果**:
- 状态恢复为"交易中"
- 可以正常下单

---

### 第23-24项：批量撤单功能测试（建议）

#### 评估要求
- 第23项：是否能提供部分撤单功能
- 第24项：是否能提供全部撤单功能

#### 第23项：部分撤单测试

**测试步骤**:

1. 先下几个不同合约的限价单
2. 打开【应急处置】标签页
3. 在"按合约撤单"输入框填写合约代码（如IF2401）
4. 点击【部分撤单】按钮

**预期结果**:
- 只有指定合约的订单被撤销
- 其他合约订单不受影响

#### 第24项：全部撤单测试

**测试步骤**:

1. 先下几个不同合约的限价单
2. 打开【应急处置】标签页
3. 点击【全部撤单】按钮

**预期结果**:
- 所有未成交订单全部被撤销
- 委托表格清空或全部显示"已撤"

---

### 第25项：日志记录功能测试（严重）

#### 评估要求
- 是否能提供日志记录功能
- 日志信息是否包括交易日志、系统运行记录、监测记录、错误提示等信息

#### 测试步骤

**步骤1：查看日志功能**

1. 打开【日志查看】标签页
2. 确认以下元素存在：
   - 日志类型选择器
   - 日志级别选择器
   - 刷新按钮
   - 导出按钮
   - 日志显示区域

**步骤2：查看交易日志**

1. 日志类型选择"交易日志"
2. 点击【刷新】
3. 查看日志内容

**预期结果**:
- 显示开仓、平仓、撤单等交易相关日志
- 包含时间戳、操作类型、合约、价格、数量等信息

**步骤3：查看系统运行记录**

1. 日志类型选择"系统日志"
2. 点击【刷新】

**预期结果**:
- 显示系统启动、连接、登录等系统运行日志

**步骤4：查看监测记录**

1. 日志类型选择"监测日志"
2. 点击【刷新】

**预期结果**:
- 显示阈值检查、统计更新等监测日志

**步骤5：查看错误提示信息**

1. 日志级别选择"错误"
2. 点击【刷新】

**预期结果**:
- 显示系统错误、验证失败等错误日志

**步骤6：测试日志导出**

1. 点击【导出】按钮
2. 保存日志文件

**预期结果**:
- 成功下载日志文件
- 文件包含完整的日志记录

#### 日志类型说明

| 类型 | 说明 | 包含内容 |
|------|------|----------|
| TRADE | 交易日志 | 报单、成交、撤单等交易操作 |
| SYSTEM | 系统日志 | 启动、连接、登录、配置变更等 |
| MONITOR | 监测日志 | 阈值检查、统计更新、状态变化等 |
| ALERT | 预警日志 | 预警触发、预警发送等 |
| ERROR | 错误日志 | 各类错误和异常 |

#### 日志级别说明

| 级别 | 说明 |
|------|------|
| DEBUG | 调试信息 |
| INFO | 一般信息 |
| WARNING | 警告信息 |
| ERROR | 错误信息 |
| CRITICAL | 严重错误 |

---

## 五、自动化测试

### 5.1 运行全部测试

```bash
cd ctp_trading_system
python -m tests.run_tests
```

### 5.2 运行指定测试

```bash
# 只运行严重级别测试
pytest tests/test_assessment.py -m critical

# 只运行特定评估项测试
pytest tests/test_assessment.py -k "test_11"

# 运行并生成HTML报告
pytest tests/test_assessment.py --html=report.html
```

### 5.3 测试报告

测试完成后会生成测试报告：

```
tests/reports/
├── assessment_report.json    # JSON格式报告
├── assessment_report.html    # HTML格式报告
└── screenshots/              # 测试截图
```

### 5.4 自动化测试清单

| 测试用例 | 评估项 | 问题等级 |
|----------|--------|----------|
| test_01_01_connect_server | 第1项 | 严重 |
| test_01_02_authenticate | 第1项 | 严重 |
| test_01_03_login | 第1项 | 严重 |
| test_02_open_position | 第2项 | 严重 |
| test_03_close_position | 第3项 | 严重 |
| test_04_cancel_order | 第4项 | 严重 |
| test_05_connection_monitoring | 第5项 | 严重 |
| test_06_repeat_open_monitoring | 第6项 | 建议 |
| test_07_repeat_close_monitoring | 第7项 | 建议 |
| test_08_repeat_cancel_monitoring | 第8项 | 建议 |
| test_09_total_order_monitoring | 第9项 | 严重 |
| test_10_total_cancel_monitoring | 第10项 | 严重 |
| test_11_01_repeat_order_threshold_setting | 第11项 | 建议 |
| test_11_02_repeat_open_alert | 第11项 | 建议 |
| test_11_03_repeat_close_alert | 第11项 | 建议 |
| test_11_04_repeat_cancel_alert | 第11项 | 建议 |
| test_12_01_total_order_threshold_setting | 第12项 | 严重 |
| test_12_02_total_order_alert | 第12项 | 严重 |
| test_13_01_total_cancel_threshold_setting | 第13项 | 严重 |
| test_13_02_total_cancel_alert | 第13项 | 严重 |
| test_14_invalid_instrument | 第14项 | 严重 |
| test_15_invalid_price | 第15项 | 严重 |
| test_16_invalid_volume | 第16项 | 严重 |
| test_17_insufficient_margin | 第17项 | 严重 |
| test_18_insufficient_position | 第18项 | 严重 |
| test_19_non_trading_time | 第19项 | 严重 |
| test_20_pause_trading | 第20项 | 严重 |
| test_23_cancel_by_instrument | 第23项 | 建议 |
| test_24_cancel_all | 第24项 | 建议 |
| test_25_01_logging_function_exists | 第25项 | 严重 |
| test_25_02_trade_log | 第25项 | 严重 |
| test_25_03_system_log | 第25项 | 严重 |
| test_25_04_monitor_log | 第25项 | 严重 |
| test_25_05_error_log | 第25项 | 严重 |
| test_25_06_log_export | 第25项 | 严重 |
| test_25_07_log_filter | 第25项 | 严重 |

---

## 六、常见问题

### Q1: 无法连接到CTP服务器

**可能原因**:
- 网络问题
- 服务器地址错误
- 非交易时间（SimNow在非交易时间可能不可用）

**解决方法**:
1. 检查网络连接
2. 确认服务器地址正确
3. 在交易时间测试（周一至周五 9:00-15:00）

### Q2: 登录失败

**可能原因**:
- 账号密码错误
- 账号未激活
- 首次登录需要修改密码

**解决方法**:
1. 确认账号密码正确
2. 登录SimNow官网确认账号状态
3. 在官网修改密码后重试

### Q3: 自动化测试失败

**可能原因**:
- Web服务未启动
- Playwright浏览器未安装
- 测试账号配置错误

**解决方法**:
1. 确保Web服务正在运行
2. 运行 `playwright install chromium`
3. 检查测试配置文件

### Q4: 预警未触发

**可能原因**:
- 阈值设置过高
- 预警方式未启用
- 浏览器阻止弹窗

**解决方法**:
1. 降低阈值设置
2. 确认预警方式已勾选
3. 允许浏览器弹窗

### Q5: 日志为空

**可能原因**:
- 未执行任何操作
- 日志类型/级别筛选过滤了所有日志

**解决方法**:
1. 先执行一些操作生成日志
2. 将日志类型和级别设为"全部"

---

## 七、附录

### A. 评估表要求汇总

| 序号 | 评价类型 | 评价指标 | 评价内容 | 问题等级 |
|------|----------|----------|----------|----------|
| 1 | 接口适应性 | 连通性 | 认证功能、登录系统 | 严重 |
| 2 | 基础交易功能 | - | 开仓指令 | 严重 |
| 3 | 基础交易功能 | - | 平仓指令 | 严重 |
| 4 | 基础交易功能 | - | 撤单指令 | 严重 |
| 5 | 异常监测 | 连接状态监测 | 启动/运行/断开/重连 | 严重 |
| 6 | 异常监测 | 重复报单监测 | 单合约重复开仓 | 建议 |
| 7 | 异常监测 | 重复报单监测 | 单合约重复平仓 | 建议 |
| 8 | 异常监测 | 重复报单监测 | 单合约重复撤单 | 建议 |
| 9 | 异常监测 | 报撤单笔数监测 | 账号报单数量 | 严重 |
| 10 | 异常监测 | 报撤单笔数监测 | 账号撤单数量 | 严重 |
| 11 | 阈值管理 | 阈值设置及预警 | 重复报单阈值+预警 | 建议 |
| 12 | 阈值管理 | 阈值设置及预警 | 报单总笔数阈值+预警 | 严重 |
| 13 | 阈值管理 | 阈值设置及预警 | 撤单总笔数阈值+预警 | 严重 |
| 14 | 错误防范 | 交易指令检查 | 合约代码错误 | 严重 |
| 15 | 错误防范 | 交易指令检查 | 价格最小变动 | 严重 |
| 16 | 错误防范 | 交易指令检查 | 委托数量错误 | 严重 |
| 17 | 错误防范 | 错误提示功能 | 资金不足提示 | 严重 |
| 18 | 错误防范 | 错误提示功能 | 持仓不足提示 | 严重 |
| 19 | 错误防范 | 错误提示功能 | 非交易时间提示 | 严重 |
| 20 | 应急处置 | 暂停交易功能 | 暂停/恢复交易 | 严重 |
| 23 | 应急处置 | 批量撤单功能 | 部分撤单 | 建议 |
| 24 | 应急处置 | 批量撤单功能 | 全部撤单 | 建议 |
| 25 | 日志记录 | 日志记录功能 | 完整日志记录 | 严重 |

> 注：第21-22项在标准中未定义

### B. 测试环境配置示例

```python
# tests/config.py

# CTP测试服务器配置
CTP_CONFIG = {
    "broker_id": "9999",
    "trade_front": "tcp://180.168.146.187:10201",
    "md_front": "tcp://180.168.146.187:10211",
    "investor_id": "YOUR_ACCOUNT",
    "password": "YOUR_PASSWORD",
    "app_id": "",
    "auth_code": ""
}

# 测试阈值配置
TEST_THRESHOLDS = {
    "repeat_open": 3,
    "repeat_close": 3,
    "repeat_cancel": 3,
    "total_order": 10,
    "total_cancel": 5
}

# 预警配置
ALERT_CONFIG = {
    "enable_popup": True,
    "enable_sound": True,
    "enable_email": False,
    "enable_sms": False
}
```

### C. 联系方式

如有测试问题，请联系：

- 技术支持邮箱: support@example.com
- 文档反馈: docs@example.com

---

**文档版本历史**

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| 1.0 | 2026-01-10 | 初始版本 | - |
